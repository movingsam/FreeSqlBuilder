@using FreeSql.TemplateEngine
@model FreeSql.TemplateEngine.BuildTask
@{
    Layout = "_Layout.cshtml";
    var project = Model.Project;
    var table = Model.CurrentTable;    
    var navigates = table.ColumnsByCs.Where(x => table.GetTableRef(x.Value.CsName, false) != null).ToList();
}


@table.GetNameSpaceUsing();

namespace @(project.ProjectInfo.ProjectName).Implaments.Services
{
@($"{(string.IsNullOrWhiteSpace(table.Comment) ? table.CsName : table.Comment)}服务".GetCSharpSummary())
    public class  @(Model.CurrentBuilder.GetName(table.CsName)) : ServiceBase, I@(Model.CurrentBuilder.GetName(table.CsName))
    {
    private readonly I@(project.GetBuilder("Repository").GetName(table.CsName))  _@(table.CsName.ToLower())Rep;
    @foreach (var (_,navigate) in navigates)
    {
       
        @:private readonly I@(project.GetBuilder("Repository").GetName(navigate.Table.CsName)) _@(navigate.Table.CsName.ToLower())Rep;
        
    }

    @("构造函数".GetCSharpSummary())
    public @(Model.CurrentBuilder.GetName(table.CsName))(IServiceProvider service):base(service)
    {
    _@(table.CsName.ToLower() + "Rep") = service.GetRequiredService<@($"I{project.GetBuilder("Repository").GetName(table.CsName)}")>
        ();
        @foreach (var (_,navigate) in navigates)
        {
            
            @: _@(navigate.Table.CsName.ToLower() + "Rep") = service.GetRequiredService<@($"I{project.GetBuilder("Repository").GetName(navigate.Table.CsName)}")>();
        }
    }

    @{ await Html.RenderPartialAsync("CURD/_CRUD.cshtml", new CurdTask(Model, table)); }
    @foreach (var (_,navigate) in navigates)
    {
        @:@{ await Html.RenderPartialAsync("CURD/_CRUD.cshtml", new CurdTask(Model, navigate?.Table)); }
    }
    }
}
