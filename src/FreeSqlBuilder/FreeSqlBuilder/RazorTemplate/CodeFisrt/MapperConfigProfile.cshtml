@using FreeSqlBuilder.TemplateEngine.Utilities
@model FreeSqlBuilder.TemplateEngine.BuildTask
@{
    Layout = "_Layout.cshtml";
    var project = Model.Project;
    var allTable = Model.AllTable;
    string[] allDtos = { "Dtos", "PostDataDto", "PageViewDto" };
    var nameSpace = allTable.Select(x => x.Type.Namespace).Distinct();
}

using AutoMapper;
@foreach (var table in allTable)
{
@:using @(project.ProjectInfo.ProjectName).@("Dtos.{TableName}".Replace("{TableName}",table.CsName));
}
@foreach (var nameSpac in nameSpace) {
@:using @nameSpac;
}

namespace @(project.ProjectInfo.ProjectName).@(Model.CurrentBuilder.ReplaceTablePath("").Replace("/","."))
{
    /// <summary>
    /// automapper配置文件
    /// </summary>
    public class @(project.ProjectInfo.ProjectName)AutoMapperProfiles : Profile
    {
        public @(project.ProjectInfo.ProjectName)AutoMapperProfiles()
        {
            @foreach (var table in allTable)
            {
                Html.NewLine();
                var entityName =table.CsName;
                @://@(entityName) 配置
                foreach (var dto in allDtos)
                {
                    var dtoName = project.GetBuilder(dto).GetName(table.CsName);
                    @:CreateMap<@($"{entityName},{dtoName}")>();
                    @:CreateMap<@($"{dtoName},{entityName}")>();
                    Html.NewLine();
                }
                Html.NewLine();
                Html.NewLine();

            }
         }
      }
}